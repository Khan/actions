name: Node CI

on:
  - pull_request

jobs:
  changeset:
    name: Check for .changeset file
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: "Get All Changed Files"
        id: changed
        uses: jaredly/get-changed-files@v1.0.1
        with:
          format: json
      - name: "Check for Changeset"
        uses: actions/github-script@v6
        with:
          script: |
              const inputFiles = JSON.parse(`${{ steps.changed.outputs.added_modified }}`);
              core.debug("Changed files: " + inputFiles);

              const hasChangeset = inputFiles.some(name => {
                return /^\.changeset\/.*\.md/.test(name);
              });
              core.info(`This PR has a changeset: ${hasChangeset}`);

              if (!hasChangeset) {
                core.setFailed(
                  "This PR does not have a changeset. You can add one by " +
                  "running `yarn changeset` and following the prompts.\n" +
                  "If this PR doesn't need a changeset, run `yarn changeset " +
                  "--empty` and commit results."
                );
              }
